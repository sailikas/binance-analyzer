# iQOO设备后台运行完全配置指南

## 📱 适用设备
- iQOO全系列
- vivo全系列
- Android 13+

## 🎯 目标效果
- ✅ 应用在后台运行，不显示在最近任务中
- ✅ 锁屏状态下继续运行
- ✅ 定时任务正常执行
- ✅ 通知正常推送

---

## 🔧 必须完成的设置（共6步）

### 第1步：自启动管理
```
路径1: i管家 → 应用管理 → 权限管理 → 自启动 → 币安分析工具 → 开启
路径2: 设置 → 应用与权限 → 权限管理 → 自启动 → 币安分析工具 → 允许
```

**作用**: 允许应用开机自动启动和被杀死后重启

---

### 第2步：后台高耗电
```
路径: i管家 → 省电管理 → 后台高耗电 → 币安分析工具 → 允许
```

**作用**: 允许应用在后台使用更多CPU资源

---

### 第3步：后台耗电管理
```
路径: 设置 → 电池 → 后台耗电管理 → 币安分析工具 → 允许后台高耗电
```

**作用**: 关闭电池优化限制

---

### 第4步：后台冻结
```
路径: i管家 → 应用管理 → 应用列表 → 币安分析工具 → 后台冻结 → 关闭
```

**作用**: 防止系统冻结后台应用

---

### 第5步：锁定后台
```
操作: 最近任务 → 找到币安分析工具 → 下拉卡片 → 点击锁定图标🔒
```

**作用**: 防止清理后台时被杀死

---

### 第6步：通知权限
```
路径: 设置 → 通知与状态栏 → 应用通知 → 币安分析工具 → 允许通知
```

**作用**: 确保能收到分析结果通知

---

## 🚀 应用内设置

### 1. 开启定时任务
```
应用内 → 定时设置 → 启用定时分析 → 开启
```

### 2. 设置运行间隔
```
建议间隔: 2-4小时（平衡电量和及时性）
```

### 3. 配置通知
```
☑ 发现变化时通知
☑ 分析完成后通知
```

### 4. Server酱配置（可选）
```
设置 → Server酱设置 → 启用 → 填写SendKey
```

---

## 🔍 验证设置是否生效

### 方法1: 查看后台运行状态
```bash
# 连接手机到电脑
adb devices

# 查看应用进程
adb shell ps | grep binance

# 查看WakeLock状态
adb shell dumpsys power | grep BinanceAnalyzer
```

**预期输出**:
```
u0_a123   12345  456  1234567  45678 S org.binance.binanceanalyzer
Wake Locks: PARTIAL_WAKE_LOCK 'BinanceAnalyzer::AppWakeLock'
```

### 方法2: 测试定时任务
```
1. 设置定时间隔为5分钟
2. 锁屏并等待5分钟
3. 解锁后检查是否收到通知
```

### 方法3: 查看日志
```bash
# 实时查看应用日志
adb logcat | grep -i binance

# 查看定时分析日志
adb logcat | grep "定时分析"
```

---

## ⚠️ 常见问题

### Q1: 应用还是显示在最近任务中
**A**: 这是正常的。Android 13+不允许应用完全隐藏。但设置完成后，即使显示在最近任务中，也不会被系统杀死。

**解决方案**:
- 锁定后台（最近任务中下拉卡片并锁定）
- 不要手动划掉应用

### Q2: 锁屏后定时任务不执行
**A**: 检查以下设置：
1. 后台高耗电是否允许
2. 后台冻结是否关闭
3. WakeLock是否获取成功

**验证命令**:
```bash
adb shell dumpsys power | grep BinanceAnalyzer
```

### Q3: 通知不显示
**A**: 
1. 检查通知权限是否开启
2. 检查通知渠道是否被禁用
3. 尝试使用Server酱作为备用通知

**解决方案**:
```
设置 → 通知与状态栏 → 应用通知 → 币安分析工具 
→ 允许通知 → 所有通知类别都开启
```

### Q4: 电量消耗过快
**A**: 
1. 增加定时间隔（改为4-6小时）
2. 减少最大分析数量（设置 → 最大分析数量 → 改为200）
3. 仅在充电时使用

### Q5: 应用被系统杀死
**A**: 
1. 确认所有6步设置都已完成
2. 检查是否开启了"省电模式"（需关闭）
3. 将应用加入"白名单"

**iQOO白名单路径**:
```
i管家 → 省电管理 → 后台高耗电 → 币安分析工具 → 允许
```

---

## 🎨 使用技巧

### 技巧1: 完全后台运行
```
1. 启动应用
2. 等待2秒（应用会自动最小化）
3. 不要在最近任务中划掉
4. 锁定后台（下拉卡片锁定）
```

### 技巧2: 查看运行状态
```
方法1: 查看前台服务通知（通知栏中会显示"后台服务运行中"）
方法2: 查看定时分析通知（每次分析完成会收到通知）
方法3: 查看历史记录（应用内 → 历史记录）
```

### 技巧3: 省电模式
```
1. 夜间增加定时间隔（改为6-8小时）
2. 关闭"发现变化时通知"（减少通知频率）
3. 仅在WiFi环境下使用
```

### 技巧4: 远程监控
```
1. 配置Server酱（可推送到微信）
2. 开启"分析完成后通知"
3. 即使不在手机旁也能收到通知
```

---

## 📊 电量消耗参考

### 不同间隔的电量消耗（iQOO设备实测）

| 定时间隔 | 每天分析次数 | 预计电量消耗 | 推荐场景 |
|---------|------------|------------|---------|
| 1小时 | 24次 | ~8-10% | 充电时 |
| 2小时 | 12次 | ~4-6% | 日常使用 |
| 4小时 | 6次 | ~2-3% | 省电模式 |
| 6小时 | 4次 | ~1-2% | 夜间模式 |
| 8小时 | 3次 | ~1% | 极致省电 |

**注**: 实际电量消耗取决于：
- 分析的币种数量
- 网络状况（WiFi vs 移动数据）
- 手机型号和电池容量
- 其他后台应用数量

---

## 🔋 iQOO省电优化建议

### 1. 系统级优化
```
设置 → 电池 → 更多设置 → 睡眠模式 → 关闭
设置 → 电池 → 更多设置 → 后台耗电排行 → 币安分析工具 → 不限制
```

### 2. 网络优化
```
设置 → WLAN → 高级设置 → 在休眠状态下保持WLAN连接 → 始终
```

### 3. 应用级优化
```
应用内设置：
- 最小涨幅: 100% → 150%（减少匹配数量）
- 最大分析数量: 500 → 200（减少网络请求）
- API请求延迟: 0.15秒 → 0.2秒（降低频率）
```

---

## 🚨 紧急故障排除

### 问题: 应用完全无法运行
```
解决步骤:
1. 卸载应用
2. 重启手机
3. 重新安装应用
4. 按照本指南重新设置所有6步
5. 测试定时任务（设置为5分钟间隔）
```

### 问题: 设置后仍被杀死
```
可能原因:
1. 系统版本过旧（需Android 5.0+）
2. 系统ROM被深度定制（部分功能受限）
3. 省电模式开启（需关闭）

解决方案:
1. 更新系统到最新版本
2. 关闭所有省电相关功能
3. 联系开发者获取支持
```

---

## 📞 技术支持

### 查看详细日志
```bash
# 导出完整日志
adb logcat -d > binance_app.log

# 查看特定标签
adb logcat -s python:V

# 查看服务状态
adb shell dumpsys activity services | grep binance
```

### 报告问题时请提供
1. 手机型号和系统版本
2. 应用版本号
3. 完整的日志文件
4. 问题复现步骤
5. 已完成的设置截图

---

## ✅ 设置完成检查清单

完成以下所有项目后，应用应该可以稳定后台运行：

- [ ] 自启动管理 - 已开启
- [ ] 后台高耗电 - 已允许
- [ ] 后台耗电管理 - 已允许后台高耗电
- [ ] 后台冻结 - 已关闭
- [ ] 锁定后台 - 已锁定
- [ ] 通知权限 - 已允许
- [ ] 定时任务 - 已开启
- [ ] WakeLock - 已获取（查看日志确认）
- [ ] 前台服务 - 已启动（通知栏可见）
- [ ] 测试通过 - 锁屏5分钟后收到通知

---

**文档版本**: v1.2.0  
**更新日期**: 2025-12-19  
**适用系统**: Android 13+ (iQOO/vivo)  
**作者**: Binance Analyzer Team
